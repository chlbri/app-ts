{"version":3,"file":"subscriber2.cjs","sources":["../../src/interpreters/subscriber2.ts"],"sourcesContent":["import type { TimerState } from '@bemedev/interval2';\nimport equals from 'fast-deep-equal';\nimport { nanoid } from 'nanoid';\nimport { PrimitiveObject } from '~types';\nimport { defineO } from '~utils';\nimport type { State } from './interpreter.types';\n\nclass SubscriberClass2<Tc extends PrimitiveObject = PrimitiveObject> {\n  #subscriber: (state: State<Tc>) => void;\n  #equals: (a: State<Tc>, b: State<Tc>) => boolean;\n\n  #state: TimerState = 'idle';\n\n  get id() {\n    return this._id;\n  }\n\n  constructor(\n    subscriber: (state: State<Tc>) => void,\n    equals: (a: State<Tc>, b: State<Tc>) => boolean,\n    private _id: string,\n  ) {\n    this.#subscriber = subscriber;\n    this.#equals = equals;\n\n    this.#state = 'active';\n  }\n\n  /* v8 ignore next 3*/\n  get state() {\n    return this.#state;\n  }\n\n  get cannotPerform() {\n    return !(this.#state === 'active');\n  }\n\n  fn(previous: State<Tc>, next: State<Tc>) {\n    if (this.cannotPerform) return;\n\n    const _equals = this.#equals(previous, next);\n    if (_equals) return;\n\n    this.#subscriber(next);\n  }\n\n  close() {\n    if (this.state !== 'disposed') this.#state = 'paused';\n  }\n\n  open() {\n    if (this.state !== 'disposed') this.#state = 'active';\n  }\n\n  unsubscribe() {\n    this.close();\n    this.#state = 'disposed';\n  }\n}\n\nexport type { SubscriberClass2 };\nexport type SubscriberOptions<\n  Tc extends PrimitiveObject = PrimitiveObject,\n> = {\n  id?: string;\n  equals?: (a: State<Tc>, b: State<Tc>) => boolean;\n};\n\nexport const createSubscriber2 = <\n  Tc extends PrimitiveObject = PrimitiveObject,\n>(\n  subscriber: (state: State<Tc>) => void,\n  options?: SubscriberOptions<Tc>,\n) => {\n  const _options = defineO(options, {\n    id: nanoid(),\n    equals,\n  });\n\n  console.log(Object.keys(_options));\n  return new SubscriberClass2(subscriber, _options.equals, _options.id);\n};\n"],"names":["defineO","nanoid","equals"],"mappings":";;;;;;;;;;;;AAOA,MAAM,gBAAgB,CAAA;AAaV,IAAA,GAAA;AAZV,IAAA,WAAW;AACX,IAAA,OAAO;IAEP,MAAM,GAAe,MAAM;AAE3B,IAAA,IAAI,EAAE,GAAA;QACJ,OAAO,IAAI,CAAC,GAAG;;AAGjB,IAAA,WAAA,CACE,UAAsC,EACtC,MAA+C,EACvC,GAAW,EAAA;QAAX,IAAA,CAAA,GAAG,GAAH,GAAG;AAEX,QAAA,IAAI,CAAC,WAAW,GAAG,UAAU;AAC7B,QAAA,IAAI,CAAC,OAAO,GAAG,MAAM;AAErB,QAAA,IAAI,CAAC,MAAM,GAAG,QAAQ;;;AAIxB,IAAA,IAAI,KAAK,GAAA;QACP,OAAO,IAAI,CAAC,MAAM;;AAGpB,IAAA,IAAI,aAAa,GAAA;QACf,OAAO,EAAE,IAAI,CAAC,MAAM,KAAK,QAAQ,CAAC;;IAGpC,EAAE,CAAC,QAAmB,EAAE,IAAe,EAAA;QACrC,IAAI,IAAI,CAAC,aAAa;YAAE;QAExB,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC;AAC5C,QAAA,IAAI,OAAO;YAAE;AAEb,QAAA,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;;IAGxB,KAAK,GAAA;AACH,QAAA,IAAI,IAAI,CAAC,KAAK,KAAK,UAAU;AAAE,YAAA,IAAI,CAAC,MAAM,GAAG,QAAQ;;IAGvD,IAAI,GAAA;AACF,QAAA,IAAI,IAAI,CAAC,KAAK,KAAK,UAAU;AAAE,YAAA,IAAI,CAAC,MAAM,GAAG,QAAQ;;IAGvD,WAAW,GAAA;QACT,IAAI,CAAC,KAAK,EAAE;AACZ,QAAA,IAAI,CAAC,MAAM,GAAG,UAAU;;AAE3B;MAUY,iBAAiB,GAAG,CAG/B,UAAsC,EACtC,OAA+B,KAC7B;AACF,IAAA,MAAM,QAAQ,GAAGA,6BAAO,CAAC,OAAO,EAAE;QAChC,EAAE,EAAEC,aAAM,EAAE;gBACZC,KAAM;AACP,KAAA,CAAC;IAEF,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAClC,IAAA,OAAO,IAAI,gBAAgB,CAAC,UAAU,EAAE,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,EAAE,CAAC;AACvE;;;;"}